<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Audio Visualizer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quantico:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        body {
            font-family: Quantico, sans-serif;
            text-align: center;
            background-color: #293696;
            color: #708DC7
        }
        svg {
            display: block;
            margin: 20px auto;
            background-color: #293696;
        }
        .controls {
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>SVG Audio Visualizer</h1>
    <div class="controls">
        <label for="songSelect">Choose Song:</label>
        <select id="songSelect">
            <option value="song1">All my love</option>
            <option value="song2">Song 2</option>
            <!-- Easily add more songs here -->
        </select>
        <br><br>
        <input type="file" id="audioFile" accept="audio/*">
        <br><br>
        <audio id="audioPlayer" controls></audio>
    </div>

    <svg id="svgVisualizer" width="500" height="500" viewBox="-600 -600 1200 1200">
        <path id="cor" d="M 319.41712,580.54645 542.0765,380.03643 c 86.9341,-104.01997 83.87867,-240.83274 -2.33151,-296.102004 -49.02016,-31.071591 -101.76397,-34.142283 -163.20582,0 C 358.3921,99.55504 335.68592,117.92281 319.41712,145.71949 307.14216,121.48035 283.45051,94.274559 254.13479,78.105647 210.73073,56.764403 161.79946,49.635967 96.757741,83.934426 28.851328,129.75015 -1.1775887,261.14418 95.591985,376.53916 Z" style="display:none;" fill="hsl(200, 100%, 50%)"/>
        <path id="sol" d="m 317.74135,351.65756 -64.2623,-135.66485 132.09472,82.11294 -1.78506,-101.74864 78.5428,71.40255 41.05647,-148.16029 41.05646,137.44991 73.18762,-67.83242 1.78506,108.88889 151.73042,-71.40255 -76.75774,130.30965 83.898,1.78506 -71.40255,76.75775 171.36612,53.55191 -162.44081,42.84153 58.90711,53.55191 -101.74864,7.14026 91.03826,144.59016 -142.8051,-73.18761 -3.57013,85.68306 -67.83242,-57.12204 -33.91622,151.73041 -58.9071,-158.87067 -73.18761,66.04736 -1.78507,-87.46812 -151.73042,78.5428 91.03826,-146.37523 -96.39345,-3.57012 57.12204,-64.2623 -160.65573,-41.05647 174.93624,-49.98178 -78.5428,-89.25319 z" style="display:none;" fill="hsl(200, 100%, 50%)" />
        <circle id="circle" cx="50" cy="50" r="25" fill="hsl(200, 100%, 50%)" />
        <path id="heart" d="M -590.515625 522.19995 C -93.585938 511.789794 57.28125 353.664589 309.140625 352.073824 C 481.46875 350.98992 636.609375 505.348754 799.257812 531.643171 Z M -590.515625 522.19995" fill="hsl(200, 100%, 50%)" style="display:none;" />
        <path id="wepray" d="M36.5,11.2c0-6.4,5.2-11.4,11.4-11.4c6.4,0,11.4,5.2,11.4,11.4c0,6.4-5.2,11.4-11.4,11.4S36.5,17.4,36.5,11.2z M54.1,24.9 c-2.9-1.6-6.6-0.5-8.2,2.4l-3.2,5.8c-0.4-3-1.2-5.8-1.9-7c-1.6-3.3-3.7-4.6-3.7-4.6c-11.2-6.4-17.2,5.4-17.3,5.8 c-1.1,2.6-2.6,6.9-2.5,15.3c0.4,19.2,11.5,45.1,11.5,45.1H7.3C3.4,87.7,0,90,0,94.2c0,3.7,3.2,6,7,6h29.9c4.5,0,7.9-2.5,8.1-11 l0.3-35.5l11.4-20.8C58.1,30,57,26.4,54.1,24.9z" style="display:none;" fill="hsl(200, 100%, 50%)"/>
        <path id="cross" d="M35,19L41,19L41,30L52,30L52,36L41,36L41,57L35,57L35,36L24,36L24,30L35,30L35,19Z" style="display:none;" fill="hsl(200, 100%, 50%)">
        <g id="globos" style="display:none;" fill="hsl(200, 100%, 50%)">
            <!-- Paths -->
            <path d="m 29.429508,27.645902 c -2.378142,-9.066668 -14.937705,-10.144261 -17.613115,1.114754 -0.79083,7.032271 5.546311,13.462921 10.367214,12.708197 -0.248276,0.313536 -0.281889,0.635502 -0.752459,0.801724 0.646337,0.302271 1.244781,0.205433 1.812379,-0.148458 -0.157578,-0.318674 -0.454972,-0.462579 -0.709425,-0.660159 5.581962,-1.332167 8.719822,-8.650502 6.895406,-13.816058 z" />
            <path d="m 22.573771,42.360656 c -0.708331,3.827905 2.220613,4.579474 2.340983,5.796721 0.595062,2.066349 -0.290812,3.346289 1.449181,5.406558 0.693648,1.040437 1.087734,2.080874 0.891803,3.121311 -0.129521,1.159869 0.066764,1.505221 0.222951,1.95082" />
            <path d="m 39.406558,14.213115 c 0.535478,-0.798077 0.349495,-1.903494 0.278688,-2.898361 c -1.079667,-11.32416 -7.636309,-12.217549 -17.373693,11.927869 c -0.392137,5.480305 3.644069,11.128743 8.081967,11.64918 -0.137918,0.307767 -0.315007,0.595948 -0.661178,0.799588 0.541752,0.203192 1.103695,0.360955 1.852388,0.098531 -0.592712,-0.453921 -0.412487,-0.681983 -0.570081,-0.942519 0.5191,0.085507 0.819796,0.02541 1.024725,-0.098531" />
            <path d="M 49.216394,24.078689 C 49.687259,13.012666 33.83935,9.3931336 31.380328,22.908197 c -0.419078,4.765389 1.924774,10.411982 7.468853,12.039344 -0.036972,0.281058 -0.141599,0.545201 -0.473771,0.752459 0.53172,0.139786 1.0675,0.263333 1.672131,0.111476 -0.253074,-0.260109 -0.396371,-0.520219 -0.501639,-0.780328 4.988598,-0.213309 9.676864,-5.344935 9.670492,-10.952459 z" />
            <path d="m 30.111157,24.514581 c -0.175746,0.874386 0.254003,2.080134 -0.47295,3.941251" />
            <path d="m 29.638207,32.948858 c 0.677899,1.918075 0.972904,3.836151 0.394125,5.754226 -0.657118,2.738002 -0.628017,5.064272 -0.236475,7.173077 0.327743,1.797421 0.792665,3.423369 0.3153,6.227176 -0.518104,1.569105 -0.743025,2.845026 -0.6306,3.783601" />
            <path d="m 39.333684,35.944208 c -0.741486,1.368896 -1.542787,2.348574 -1.2612,5.517752 -0.075782,1.205607 -0.130397,2.390048 -1.024725,4.414201 -0.449485,0.960935 -1.019155,1.441133 -0.867075,4.808326 -0.02305,0.994418 0.115526,1.786805 -0.709426,3.783601 -0.456813,0.814525 -0.900645,1.62905 -0.9459,2.443575" />

        </g>
        <g id="pluja" style="display:none;" fill="hsl(200, 100%, 50%)">
            <!-- Paths -->
            <path d="M 83.726776,98.69071 C 97.141222,103.01801 118.62022,99.033882 130.4,83.014208 153.683496,93.400914 192.782734,64.930999 158.190164,47.742076 156.34611,19.769497 125.636,15.424322 112.942076,24.227322 99.89838,-3.1622036 64.942062,-0.73658276 53.086338,25.65246 38.882194,23.908966 27.983414,30.015705 21.37705,46.31694 0.2999474,46.87428 -3.265966,89.155732 32.778142,80.520218 c 6.939064,7.953608 16.10109,10.572102 27.790164,7.125684 3.3145,3.12019 4.958358,6.658042 11.757378,8.907104"/>
            <path d="M 55.936612,132.18142 90.85246,56.64918 81.232786,112.585792 99.759562,109.02295 63.062296,177.073224 73.75082,128.61858 Z"/>
            <path d="m 114.728726,107.731674 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 129.698124,111.99834 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 109.69703,119.842056 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 124.4096,123.736046 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 104.703588,131.917467 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 118.872988,135.124022 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 99.828178,143.717467 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 35.988838,98.622382 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 50.958236,102.88905 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 30.957142,110.732764 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 45.669712,114.626754 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 25.9637,122.808175 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 40.13301,126.01573 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>
            <path d="m 35.339656,138.171016 c -2.559244,-0.535008 -5.154646,2.943474 -3.3847,6.769474 2.637724,1.445072 6.539852,-4.786656 3.3847,-6.769474 z"/>

        </g>
        <g id="coldplay" style="display:none;" fill="hsl(200, 100%, 50%)">
                      <!-- Paths -->
            <path d="M 52.052996,16.980703 C 33.451377,19.950086 17.293884,53.581773 51.100807,66.970622 5.1483425,68.415607 19.416639,10.249047 52.052996,16.980703 Z" />
            <path d="M 163.7765,20.313364 C 145.96421,56.266758 187.0831,68.34424 199.95968,56.179148 170.72448,84.278014 137.89693,40.104811 163.7765,20.313364 Z" />
            <!-- Circles -->
            <circle cx="104.26469" cy="42.055012" r="25.709103" />
            <circle cx="524.97351" cy="29.359158" r="8.093606" />
             <!-- Paths -->
            <path d="m 225.19268,18.250288 c 44.99697,-4.174294 42.27784,55.063459 -0.31739,49.196429 28.37951,-13.011974 19.75892,-41.161638 0.31739,-49.196429 z" />
            <path d="m 281.21313,30.470046 c 29.49604,-31.44835306 64.49876,15.019663 35.23099,35.548387 12.45541,-19.491564 -5.30028,-48.988541 -35.23099,-35.548387 z" />
            <path d="m 359.45133,22.217742 c -31.2637,28.678816 20.55628,61.326966 35.54838,34.754896 -22.12538,15.262315 -51.70162,-7.305059 -35.54838,-34.754896 z" />
            <path d="m 418.48704,50.78341 c 9.07623,-27.461167 38.79822,-24.560657 49.03773,0.793491 4.28895,-36.343906 -52.51059,-42.6516151 -49.03773,-0.793491 z"/>
            <path d="m 486.25115,21.265553 c 35.63671,-7.300115 44.13556,53.322581 1.90438,48.561636 28.86049,-7.128449 21.61231,-44.49379 -1.90438,-48.561636 z"/>
        </g>
    </svg>
        </g>
    </svg>

    <script>
        const fileInput = document.getElementById('audioFile');
        const audioPlayer = document.getElementById('audioPlayer');
        const songSelect = document.getElementById('songSelect');
        const shapes = {
            cor: document.getElementById('cor'),
            globos: document.getElementById('globos'),
            pluja: document.getElementById('pluja'),
            sol: document.getElementById('sol'),
            circle: document.getElementById('circle'),
            heart: document.getElementById('heart'),
            wepray: document.getElementById('wepray'),
            cross: document.getElementById('cross'),
            coldplay: document.getElementById('coldplay')
        };

        let audioContext, analyser, frequencyData;
        let currentShapeIndex = 0;

        // Configuration for each song (easily scalable)
        const songConfig = {
            song1: {
                shapeOrder: ['globos','cor','pluja','sol'],
                durations: [5000, 5000, 5000, 5000]
            },
            song2: {
                shapeOrder: ['circle', 'heart', 'wepray', 'cross'],
                durations: [4000, 8000, 6000, 10000]
            }
        };
        //COPIADLO DE AQUÍ HASTA EL FINAL
        
        fileInput.addEventListener('change', handleFileUpload);
        songSelect.addEventListener('change', resetVisualizer);
        audioPlayer.addEventListener('play', startCycleShapes);
        audioPlayer.addEventListener('pause', stopCycleShapes);
    
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('audio/')) {
                const audioURL = URL.createObjectURL(file);
                audioPlayer.src = audioURL;
                audioPlayer.load();
                initAudio();
            } else {
                alert('Please upload a valid audio file.');
            }
        }
    
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
            frequencyData = new Uint8Array(analyser.frequencyBinCount);
    
            const source = audioContext.createMediaElementSource(audioPlayer);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
    
            visualize();
        }
    
        function visualize() {
            requestAnimationFrame(visualize);
            analyser.getByteFrequencyData(frequencyData);
    
            const averageFrequency = frequencyData.reduce((a, b) => a + b) / frequencyData.length;
            const scale = averageFrequency / 255;
    
            const selectedShape = shapes[getCurrentShape()];
            const hue = Math.round((averageFrequency / 255) * 360);
            selectedShape.setAttribute('fill', `hsl(${hue}, 100%, 50%)`);
            selectedShape.setAttribute('transform', `scale(${scale + 0.5})`);
        }
    
        function startCycleShapes() {
            const songData = songConfig[songSelect.value];
            updateShapeVisibility();
    
            // Avanzar a la siguiente forma después de la duración actual solo si el audio está reproduciéndose
            cycleTimeout = setTimeout(() => {
                currentShapeIndex = (currentShapeIndex + 1) % songData.shapeOrder.length;
                if (!audioPlayer.paused) {
                    startCycleShapes(); // Recursión controlada para que avance solo al reproducirse
                }
            }, songData.durations[currentShapeIndex]);
        }
    
        function stopCycleShapes() {
            clearTimeout(cycleTimeout); // Detiene el cambio de formas cuando el audio se pausa
        }
    
        function resetVisualizer() {
            clearTimeout(cycleTimeout);
            audioPlayer.currentTime = 0;
            audioPlayer.pause();
            currentShapeIndex = 0;
            updateShapeVisibility();
        }
    
        function getCurrentShape() {
            return songConfig[songSelect.value].shapeOrder[currentShapeIndex];
        }
    
        function updateShapeVisibility() {
            Object.keys(shapes).forEach(key => {
                shapes[key].style.display = key === getCurrentShape() ? 'block' : 'none';
            });
        }
    </script>    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>
</html>
